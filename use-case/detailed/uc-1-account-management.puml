@startuml "UC-1: Account & Profile Management - Final Consistent Layout"
!theme plain

' --- ACTORS ---
actor Customer
actor Guest
actor Admin

' Sắp xếp các actor thành một cột bên trái cho gọn gàng
Admin -[hidden]down- Guest
Guest -[hidden]down- Customer

' --- SYSTEM BOUNDARY ---
rectangle "Rill System" {
  usecase "Register" as UC1
  usecase "Login" as UC2
  usecase "Logout" as UC2b
  usecase "Update Personal Info" as UC3
  usecase "Manage Shipping Addresses" as UC4

  ' Dàn hàng ngang các use case
  UC1 -[hidden]right- UC2
  UC3 -[hidden]right- UC4
  ' Căn chỉnh cột actor với cột use case
  Customer -[hidden]right- UC3
}

' --- SUB USE CASES for Address Management ---
package "Address Management Details" {
  usecase "Add New Address" as Add
  usecase "Edit Address" as Edit
  usecase "Delete Address" as Delete
  usecase "Set as Default" as SetDefault

  ' Dàn hàng ngang các use case con
  Add -[hidden]right- Edit
  Edit -[hidden]right- Delete
  Delete -[hidden]right- SetDefault
}

' --- RELATIONSHIPS ---

' **THAY ĐỔI CHÍNH Ở ĐÂY**
' 1. Bổ sung kế thừa Admin --|> Guest
Customer --|> Guest
Admin --|> Guest

' 2. Gán quyền cho từng Actor
' Guest có thể Đăng ký hoặc Đăng nhập
Guest --> UC1
Guest --> UC2

' Admin và Customer (đã đăng nhập) có thể Đăng xuất
Admin --> UC2b
Customer --> UC2b

' Customer có thể quản lý thông tin cá nhân của họ
Customer --> UC3
Customer --> UC4

' Admin chỉ có thể Đăng nhập (kế thừa từ Guest) và Đăng xuất
' 3. Xóa đường nối sai từ Admin tới "Update Personal Info"

' Quan hệ <<include>>
UC4 .down.> Add       : <<include>>
UC4 .down.> Edit      : <<include>>
UC4 .down.> Delete    : <<include>>
UC4 .down.> SetDefault: <<include>>

' --- NOTES ---
note "Requires authentication" as AuthNote
UC3 .. AuthNote
UC4 .. AuthNote
UC2b .. AuthNote

@enduml
